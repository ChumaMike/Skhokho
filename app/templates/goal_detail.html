{% extends 'base.html' %}

{% block title %}{{ goal.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <a href="{{ url_for('goals.dashboard') }}" class="inline-flex items-center text-zinc-500 hover:text-white mb-6 transition">
        &larr; BACK TO DASHBOARD
    </a>

    <div class="bg-zinc-900 border border-zinc-800 p-8 rounded-xl mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-red-600/5 blur-[60px] rounded-full"></div>
        
        <div class="flex justify-between items-start">
            <div>
                <span class="text-red-500 font-mono text-xs uppercase tracking-widest">{{ goal.category }}</span>
                <h1 class="text-4xl font-bold text-white mt-2 mb-4">{{ goal.title }}</h1>
                {% if goal.description %}
                    <p class="text-zinc-400 max-w-2xl">{{ goal.description }}</p>
                {% endif %}
            </div>
            
            <a href="{{ url_for('goals.delete_goal', goal_id=goal.id) }}" onclick="return confirm('Are you sure you want to terminate this objective?')" class="text-zinc-600 hover:text-red-500 transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            </a>
        </div>

        <div class="mt-8">
            <div class="flex justify-between text-sm text-zinc-400 mb-2 font-mono">
                <span>EXECUTION STATUS</span>
                <span class="text-white">{{ goal.progress }}%</span>
            </div>
            <div class="w-full bg-black rounded-full h-4 border border-zinc-800 shadow-inner">
                <div class="bg-red-600 h-4 rounded-full transition-all duration-700 shadow-[0_0_15px_rgba(220,38,38,0.5)]" style="width: {{ goal.progress }}%"></div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        
        <div class="md:col-span-2 space-y-8">
            <!-- Subgoals Section -->
            {% if goal.subgoals %}
            <div>
                <h3 class="text-white font-bold text-xl mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500 mr-2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    Subgoals ({{ goal.subgoals|length }})
                </h3>
                
                {% for subgoal in goal.subgoals %}
                <div class="flex items-center p-4 bg-zinc-900/50 border {{ 'border-green-900/30 bg-green-900/10' if subgoal.is_completed else 'border-blue-900/30 bg-blue-900/10' }} rounded-lg hover:bg-zinc-800 transition group">
                    
                    <a href="{{ url_for('goals.view_goal', goal_id=subgoal.id) }}" class="flex-shrink-0 mr-4">
                        {% if subgoal.is_completed %}
                            <div class="w-6 h-6 bg-green-500 rounded flex items-center justify-center text-black font-bold">✓</div>
                        {% else %}
                            <div class="w-6 h-6 border-2 border-blue-600 rounded group-hover:border-blue-500"></div>
                        {% endif %}
                    </a>
                    
                    <div class="flex-1">
                        <a href="{{ url_for('goals.view_goal', goal_id=subgoal.id) }}" class="{{ 'text-zinc-500 line-through' if subgoal.is_completed else 'text-gray-200' }} hover:text-blue-400 transition">
                            {{ subgoal.title }}
                        </a>
                        {% if subgoal.description %}
                        <p class="text-zinc-500 text-sm mt-1">{{ subgoal.description }}</p>
                        {% endif %}
                        {% if subgoal.target_date %}
                        <p class="text-zinc-600 text-xs mt-1">Target: {{ subgoal.target_date.strftime('%Y-%m-%d') }}</p>
                        {% endif %}
                        {% if subgoal.progress > 0 %}
                        <div class="mt-2">
                            <div class="flex justify-between text-xs text-zinc-500 mb-1">
                                <span>Progress</span>
                                <span>{{ subgoal.progress }}%</span>
                            </div>
                            <div class="w-full bg-black rounded-full h-2 border border-zinc-800">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: {{ subgoal.progress }}%"></div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Milestones Section -->
            <div>
                <h3 class="text-white font-bold text-xl mb-4">Milestones</h3>
                
                {% for milestone in goal.milestones %}
                <div class="flex items-center p-4 bg-zinc-900/50 border {{ 'border-green-900/30 bg-green-900/10' if milestone.is_completed else 'border-zinc-800' }} rounded-lg hover:bg-zinc-800 transition group">
                    
                    <a href="{{ url_for('goals.toggle_milestone', milestone_id=milestone.id) }}" class="flex-shrink-0 mr-4">
                        {% if milestone.is_completed %}
                            <div class="w-6 h-6 bg-green-500 rounded flex items-center justify-center text-black font-bold">✓</div>
                        {% else %}
                            <div class="w-6 h-6 border-2 border-zinc-600 rounded group-hover:border-red-500"></div>
                        {% endif %}
                    </a>
                    
                    <span class="{{ 'text-zinc-500 line-through' if milestone.is_completed else 'text-gray-200' }}">
                        {{ milestone.title }}
                    </span>
                </div>
                {% else %}
                <p class="text-zinc-500 italic">No milestones defined yet.</p>
                {% endfor %}
            </div>
        </div>

        <div>
            <div class="bg-black border border-zinc-800 p-6 rounded-xl sticky top-24 space-y-6">
                <!-- Add Subgoal -->
                <div>
                    <h3 class="text-zinc-400 text-sm font-bold uppercase mb-4">Add Subgoal</h3>
                    <form action="{{ url_for('goals.add_subgoal', goal_id=goal.id) }}" method="POST">
                        <input type="text" name="subgoal_title" placeholder="E.g. Complete Research" required 
                               class="w-full bg-zinc-900 border border-zinc-700 text-white p-3 rounded mb-2 focus:border-blue-600 focus:outline-none">
                        <textarea name="subgoal_description" placeholder="Description (optional)" 
                                  class="w-full bg-zinc-900 border border-zinc-700 text-white p-3 rounded mb-4 focus:border-blue-600 focus:outline-none"></textarea>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded transition">
                            + Add Subgoal
                        </button>
                    </form>
                </div>

                <!-- Add Milestone -->
                <div>
                    <h3 class="text-zinc-400 text-sm font-bold uppercase mb-4">Add Milestone</h3>
                    <form action="{{ url_for('goals.add_milestone', goal_id=goal.id) }}" method="POST">
                        <input type="text" name="milestone_title" placeholder="E.g. Finish Module 1" required 
                               class="w-full bg-zinc-900 border border-zinc-700 text-white p-3 rounded mb-4 focus:border-red-600 focus:outline-none">
                        <button type="submit" class="w-full bg-zinc-800 hover:bg-zinc-700 hover:text-white text-zinc-300 font-bold py-2 rounded border border-zinc-700 transition">
                            + Add Milestone
                        </button>
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}